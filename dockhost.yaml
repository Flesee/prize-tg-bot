version: 1
project: prizebot

volumes:
  postgres-data:
    type: ssd
    size: 10Gib
  static-value:
    type: ssd
    size: 1Gib
  media-value:
    type: ssd
    size: 5Gib

containers:
  db:
    image: postgres:16-alpine
    replicas: 1
    resources:
      memory: 1024MiB
      cpu: 1
      cpuFraction: 100
    ports:
      - 5432
    variables:
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_DB: ${DB_NAME}
    volumes:
      - name: postgres-data
        mountPath: /var/lib/postgresql/data/

  admin:
    build:
      context: ./admin
      dockerfile: Dockerfile
    replicas: 1
    resources:
      memory: 512MiB
      cpu: 1
      cpuFraction: 50
    ports:
      - 8000:8000
    # Все переменные окружения будут автоматически доступны в контейнере
    volumes:
      - name: static-value
        mountPath: /app/static/
      - name: media-value
        mountPath: /app/media/
    depends_on:
      - db

  bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    replicas: 1
    resources:
      memory: 512MiB
      cpu: 1
      cpuFraction: 50
    variables:
      MEDIA_ROOT: /app/media
    # Все остальные переменные окружения будут автоматически доступны в контейнере
    volumes:
      - name: media-value
        mountPath: /app/media
        readOnly: true
    depends_on:
      - db
      - admin
